"use strict";function setup(){function t(){prepareLineup(),update()}ctx.canvas.width=width,ctx.canvas.height=height;for(var e=0;cols>e;e++)for(var o=0;rows>o;o++){var i=Object.create(shape);i.row=o,i.column=e;var n=4*Math.random()+1;n>=4?(i.type="d",i.fillStyle=d.color):n>=3&&4>n?(i.type="a",i.fillStyle=a.color):n>=2&&3>n?(i.type="b",i.fillStyle=b.color):2>n&&(i.type="c",i.fillStyle=c.color);var r=Object.create(i);cells.push(r)}draw(),setInterval(t,100)}function prepareLineup(){moveConvergePoints();for(var t=0;t<cells.length;t++){var e=cells[t];"alive"==e.state?("a"==e.type&&e.converge(a),"b"==e.type&&e.converge(b),"c"==e.type&&e.converge(c),"d"==e.type&&e.converge(d)):cells.pop(e)}}function draw(){for(var t=0;t<cells.length;t++)cells[t].draw()}function update(){ctx.fillStyle="rgba(255,255,255,.4)",ctx.fillRect(0,0,canvas.width,canvas.height);for(var t=0;t<cells.length;t++)cells[t].move()}function disperse(t){for(var e=t.type,o=0;o<cells.length;o++)cells[o].type==e&&(cells[o].row=(Math.random()*rows).toFixed(),cells[o].column=(Math.random()*cols).toFixed())}function moveConvergePoints(){for(var t=0;t<convPoints.length;t++){if(convPoints[t].converged<60){var e=convPoints[t].converged;playNote(cMajorHarmony[t],1,e/240,e/120,e/120)}convPoints[t].converged>60&&(convPoints[t].x=(Math.random()*(rows-3)+1).toFixed(),convPoints[t].y=(Math.random()*(cols-3)+1).toFixed(),convPoints[t].converged=0,disperse(convPoints[t]))}}var canvas=document.querySelector("#mainCanvas"),ctx=canvas.getContext("2d"),a={x:5,y:5,converged:0,total:0,type:"a",color:"rgba(0,0,0,.1)"},b={x:15,y:15,converged:0,total:0,type:"b",color:"rgba(0,0,255,.1)"},c={x:25,y:25,converged:0,total:0,type:"c",color:"rgba(43,255,102,.1)"},d={x:25,y:15,converged:0,total:0,type:"d",color:"rgba(102,51,153,.1)"},convPoints=[a,b,c,d],width=window.innerWidth,height=window.innerHeight,size=20,rows=(width/size).toFixed(),cols=(height/size).toFixed(),stateArray=[],cells=[],shape={ctx:ctx,row:0,column:0,type:"a",fillStyle:"",state:"alive",draw:function(){this.wrap(),ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.row*size-size/4,this.column*size-size/4,size/4,0,2*Math.PI),ctx.fill()},status:function(){console.log("x= "+this.x+" y= "+this.y)},move:function(){this.draw()},converge:function(t){var e=4*Math.random()+1;4>e&&(this.row==t.x&&this.column==t.y&&(t.converged+=1),(t.x<this.row||this.row<t.x)&&(this.row>t.x&&(this.row-=1),this.row<t.x&&(this.row+=1)),(t.y<this.column||this.column<t.y)&&(this.column>t.y&&(this.column-=1),this.column<t.y&&(this.column+=1)))},wrap:function(){this.row>rows&&(this.row=1),this.row<1&&(this.row=rows),this.column>cols&&(this.column=1),this.column<1&&(this.column=cols)}};setup(),window.onresize=function(){width=window.innerWidth,height=window.innerHeight,ctx.canvas.width=width,ctx.canvas.height=height;(width/size).toFixed(),(height/size).toFixed()};